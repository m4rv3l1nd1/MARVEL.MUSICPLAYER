<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hand Controlled Game</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #f0f0f0;
        }
        canvas {
            display: block;
            position: absolute;
        }
        #webcam {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.5;
        }
    </style>
</head>
<body>

<video id="webcam" autoplay></video>
<canvas id="gameCanvas"></canvas>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/handpose"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/handpose"></script>

<script>
    let video;
    let model;
    let canvas, ctx;
    let gameObject;

    // Setup Webcam and canvas
    async function setupWebcam() {
        video = document.getElementById('webcam');
        canvas = document.getElementById('gameCanvas');
        ctx = canvas.getContext('2d');
        
        // Get webcam stream
        const stream = await navigator.mediaDevices.getUserMedia({
            video: true
        });
        video.srcObject = stream;
        
        // Set canvas size to match video
        video.onloadedmetadata = () => {
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
        };
    }

    // Load HandPose model from TensorFlow
    async function loadHandPoseModel() {
        model = await handpose.load();
        console.log("HandPose model loaded.");
        detectHands();
    }

    // Detect hands and get hand landmarks
    async function detectHands() {
        const predictions = await model.estimateHands(video);

        if (predictions.length > 0) {
            const hand = predictions[0];
            const landmarks = hand.landmarks;

            // Get the wrist position (index 0) to control the game object
            const wrist = landmarks[0];
            controlGameObject(wrist);
            
            // Draw the hand on the canvas
            drawHand(landmarks);
        }

        requestAnimationFrame(detectHands);
    }

    // Control the game object based on hand position (wrist)
    function controlGameObject(wrist) {
        if (!gameObject) return;

        // Get wrist coordinates
        const [x, y] = wrist;

        // Normalize wrist position (for the game object control)
        gameObject.x = x;
        gameObject.y = y;
    }

    // Draw hand landmarks on canvas
    function drawHand(landmarks) {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Draw each landmark
        landmarks.forEach(([x, y]) => {
            ctx.beginPath();
            ctx.arc(x, y, 5, 0, 2 * Math.PI);
            ctx.fillStyle = 'red';
            ctx.fill();
        });
    }

    // Game setup
    function setupGame() {
        gameObject = { x: canvas.width / 2, y: canvas.height / 2, size: 50 };

        // Start the game loop
        gameLoop();
    }

    // Game Loop
    function gameLoop() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // Draw game object
        ctx.beginPath();
        ctx.arc(gameObject.x, gameObject.y, gameObject.size, 0, 2 * Math.PI);
        ctx.fillStyle = "green";
        ctx.fill();

        requestAnimationFrame(gameLoop);
    }

    // Initialize everything
    async function init() {
        await setupWebcam();
        await loadHandPoseModel();
        setupGame();
    }

    init();
</script>

</body>
</html>
